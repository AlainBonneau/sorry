<template>
  <div class="app-container">
    <!-- Thai flag background -->
    <div class="flag-stripe red"></div>
    <div class="flag-stripe white"></div>
    <div class="flag-stripe blue"></div>
    <div class="flag-stripe white"></div>
    <div class="flag-stripe red"></div>

    <!-- Content on top of the flag -->
    <div class="content">
      <!-- envelope without heart -->
      <button @click="showModal = true" class="open-modal">
        ✉️ กดเพื่ออ่านข้อความของฉัน ✉️
      </button>

      <div class="question">
        <p>คุณสามารถส่งข้อความถึงฉันที่นี่หากคุณต้องการ</p>
        <textarea
          v-model="userMessage"
          placeholder="คุณสามารถเขียนข้อความถึงฉันตรงนี้ได้นะ..."
          class="user-message"
        />
        <div class="buttons">
          <button @click="prepareResponse('yes')">ใช่</button>
          <button @click="prepareResponse('no')">ไม่</button>
        </div>
      </div>
    </div>

    <!-- Message Modal -->
    <div v-if="showModal" class="modal-overlay" @click.self="showModal = false">
      <div class="envelope animate-pop">
        <div class="letter">
          <div class="letter-background">
            <div class="letter-text">
              <p>
                สวัสดี SkyLee,
                ฉันอยากแบ่งปันบางสิ่งเกี่ยวกับตัวฉันให้เธอเข้าใจมากขึ้น...
                <span class="underline-text">
                  เด็กบางคนถูกเรียกว่า "มีพรสวรรค์"
                  ซึ่งหมายถึงพวกเขามีความสามารถทางสติปัญญาสูงกว่าคนทั่วไป
                  แต่สิ่งสำคัญคือ การมีพรสวรรค์ไม่ได้หมายถึงการ "ฉลาด"
                  เพียงอย่างเดียว
                  เด็กที่มีพรสวรรค์หลายคนยังมีความรู้สึกที่ลึกซึ้งมากกว่าคนอื่นมาก
                  พวกเขาอาจเป็นคนอ่อนไหวมาก มีความเห็นอกเห็นใจผู้อื่น
                  หรืออาจถูกครอบงำได้ง่ายจากความรู้สึกที่รุนแรงหรือสถานการณ์ที่ไม่ยุติธรรม
                  สิ่งนี้มักเรียกว่า "ความเข้มข้นทางอารมณ์"
                  ซึ่งหมายความว่าสมองและหัวใจของพวกเขาทำงานในระดับสูงทั้งคู่
                  แม้ว่าพวกเขาอาจเรียนรู้ได้เร็วและมีความคิดที่น่าทึ่ง
                  แต่พวกเขาก็อาจประสบปัญหากับสิ่งต่างๆ เช่น ความวิตกกังวล
                  ความสมบูรณ์แบบ หรือความรู้สึกว่าไม่ได้รับการเข้าใจได้เช่นกัน
                  มันไม่ใช่เรื่องง่ายสำหรับพวกเขาเสมอไป
                  แม้ว่าพวกเขาจะดูมีความสามารถมากก็ตาม
                </span>
                ฉันเองก็มีลักษณะเหล่านี้ และมันมีทั้งข้อดีและข้อเสีย
                มันช่วยให้ฉันเรียนรู้ได้เร็ว เข้าใจลึก
                และประสบความสำเร็จในการเรียน
                แต่มันก็ทำให้การเข้าสังคมหรือสร้างความสัมพันธ์กับคนทั่วไปเป็นเรื่องที่ซับซ้อน
                บางครั้งคนอาจเข้าใจผิด คิดว่าฉันเย็นชา หรือแสดงอารมณ์มากเกินไป
                แต่จริง ๆ
                แล้วฉันแค่รู้สึกทุกอย่างแรงและซื่อสัตย์กับความรู้สึกของตัวเอง
                ฉันไม่ต้องการการปฏิบัติพิเศษใด ๆ
                แค่หวังว่าเธอจะเข้าใจว่านี่คือวิธีที่ฉันมองโลก
                และใช้หัวใจกับทุกสิ่งที่ฉันทำ หากเธออยากเข้าใจสิ่งนี้มากขึ้น
                ลองดูเว็บไซต์นี้นะ (ภาษาอังกฤษ) :
                <a
                  href="https://www.canoncityschools.org/departments/gifted-talented-education/social-emotional-affective"
                  target="_blank"
                  >ลิงค์เว็บไซต์</a
                >
              </p>
              <p>
                ฉันรู้ตัวดีว่าที่ผ่านมาฉันอาจแสดงออกแบบนั้นกับเธอ
                และฉันขอโทษจริง ๆ ฉันควบคุมตัวเองไม่ค่อยได้ในบางสถานการณ์
                และมันไม่ใช่สิ่งที่ฉันตั้งใจเลย
                ฉันถูกวินิจฉัยว่าเป็นแบบนี้ตั้งแต่ยังเล็กมาก —
                ตอนที่ฉันเล่นบล็อกตัวอักษร แล้วเรียงตัวอักษรจาก A ถึง Z
                ได้อย่างถูกต้องโดยไม่ผิดเลย หลังจากนั้นฉันก็ต้องไปพบแพทย์หลายคน
                จนพวกเขาวินิจฉัยออกมาว่าฉันมีลักษณะนี้
                หลายคนคิดว่ามันเป็นเรื่องดี เพราะพวกเขาเห็นแค่ด้านที่ว่า
                "เรียนรู้เร็ว ฉลาด ฯลฯ"
                แต่พวกเขาไม่รู้เลยว่ามันมีอีกด้านที่ไม่ค่อยสนุกนัก — เช่น
                การคิดมากเกินไป คิดตลอดเวลา แม้ในเวลาที่ไม่ควรคิด
                มันเป็นเหมือนสมองที่ไม่เคยพัก
                ฉันเสียใจที่เธอต้องเจอกับด้านแบบนี้ของฉัน และเพราะแบบนั้น
                ฉันเลยอยากรู้ว่า… ตอนนี้มิตรภาพของเรายังอยู่ตรงไหน
                ฉันคิดถึงมันมาก และมันวนเวียนอยู่ในใจฉันตลอด
                การที่ฉันยังไม่ได้รับคำตอบที่ชัดเจน ทำให้ฉันคิดไปเรื่อย ๆ
                แบบไม่หยุด ถ้าเธอพอจะบอกอะไรฉันได้บ้าง ฉันจะขอบคุณมากจริง ๆ
                ขอบคุณล่วงหน้าจากใจจริง
              </p>
              <p>
                ( ถ้าเธอช่วยไม่พูดถึงเรื่องนี้กับคนอื่นได้ ฉันจะขอบคุณมากเลยนะ
                ฉันไม่เคยบอกใครเรื่องนี้มากนักในชีวิต
                และฉันก็ไม่ได้อยากให้คนอื่นรู้มากกว่านี้เท่าไร )
              </p>
              <div class="close-modal" @click.self="showModal = false">ปิด</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Simple Confirmation Modal -->
    <div v-if="confirmModal" class="simple-modal">
      <div class="simple-modal-box animate-pop">
        <p style="margin-bottom: 1rem">คุณแน่ใจหรือไม่?</p>
        <div class="buttons">
          <button @click="confirmResponse">ยืนยัน</button>
          <button @click="confirmModal = false">ยกเลิก</button>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref } from "vue";

const showModal = ref(false);
const confirmModal = ref(false);
const pendingAnswer = ref("");
const userMessage = ref(""); // Nouveau champ texte

function prepareResponse(answer) {
  pendingAnswer.value = answer;
  confirmModal.value = true;
}

function confirmResponse() {
  confirmModal.value = false;

  fetch("https://formspree.io/f/xdkewgjp", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify({
      message: pendingAnswer.value,
      note: userMessage.value, // On envoie le contenu de la zone texte
    }),
  })
    .then(() => {
      if (pendingAnswer.value === "yes") {
        alert(
          "ได้รับการตอบกลับแล้ว ฉันจะติดต่อคุณอีกครั้ง (คุณสามารถปลดบล็อกฉันบนอินสตาได้ไหม) 🙂"
        );
      } else {
        alert("ฉันเข้าใจแล้ว ฉันจะไม่รบกวนคุณอีกแล้ว ขอบคุณสำหรับทุกอย่าง");
      }
      userMessage.value = ""; // Réinitialise le champ texte après envoi
    })
    .catch((err) => {
      alert("Oops, something went wrong 😢");
      console.error(err);
    });
}
</script>

<style scoped>
.app-container {
  height: 100vh;
  overflow: hidden;
  font-family: sans-serif;
  color: #333;
  position: relative;
}

.flag-stripe {
  height: 20vh;
  width: 100%;
}

.red {
  background-color: #a51931;
}
.white {
  background-color: #ffffff;
}
.blue {
  background-color: #2d2a4a;
}

.content {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
  z-index: 10;
}

.open-modal {
  margin-bottom: 2rem;
  padding: 0.6rem 1.2rem;
  background: #a51931;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 1.1rem;
}

.close-modal {
  margin-top: 1rem;
  padding: 0.5rem 1rem;
  background: #a51931;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}

.question p {
  font-size: 1.2rem;
  margin-bottom: 1rem;
  color: #fff;
}

.user-message {
  width: 100%;
  max-width: 400px;
  height: 100px;
  padding: 0.6rem;
  font-size: 1rem;
  border-radius: 6px;
  border: none;
  resize: none;
  margin-bottom: 1.5rem;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.underline-text {
  text-decoration: underline;
  text-decoration-color: #a51931;
  text-decoration-thickness: 1.5px;
}

.buttons button {
  margin: 0 0.5rem;
  padding: 0.5rem 1.2rem;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  background-color: #a51931;
  color: white;
  font-size: 1rem;
  transition: background-color 0.3s ease, transform 0.2s ease;
}

.buttons button:hover {
  background-color: #c72745;
  transform: scale(1.05);
}

.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 20;
}

.modal-overlay:before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-image: url("../bg.jpg");
  background-size: cover;
  background-position: center;
  filter: blur(5px);
}

.envelope {
  background: white;
  border-radius: 10px;
  width: 90%;
  max-width: 600px;
  overflow: hidden;
}

.letter {
  position: relative;
  padding: 0;
}

.letter-background {
  background-image: url("../modal-bg.png");
  background-size: cover;
  background-position: center;
  padding: 2rem;
  min-height: 300px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.letter-text {
  background-color: rgba(255, 255, 255, 0.85);
  padding: 1rem;
  border-radius: 10px;
  font-size: 1rem;
  line-height: 1.6;
  text-align: center;
  max-height: 80vh;
  overflow-y: auto;
}

/* Simple modal confirmation */
.simple-modal {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.5);
  z-index: 30;
  display: flex;
  align-items: center;
  justify-content: center;
}

.simple-modal-box {
  background: white;
  padding: 2rem;
  border-radius: 12px;
  text-align: center;
  box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
}

/* Animations */
@keyframes popIn {
  from {
    transform: scale(0.8);
    opacity: 0;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
}

.animate-pop {
  animation: popIn 0.3s ease;
}
</style>
